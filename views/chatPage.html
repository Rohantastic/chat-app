<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chat-app</title>
    <link rel="stylesheet" href="/css/chat.css">
</head>

<body>
    <div class="head-bar">
        <h4 style=" color:  #88a9c4ff; font-family: 'Courier New', Courier, monospace;" id="logged-username">:</h4>
        <h4 style=" color:  #88a9c4ff; font-family: 'Courier New', Courier, monospace;">Chat App</h4>
        <h4 style=" color:  #88a9c4ff; font-family: 'Courier New', Courier, monospace;"><a href="/login" style="text-decoration: none;">Log out</a></h4>
    </div>
    <div class="container">
        <div class="groups">
            <div class="groups-title">Groups
                <hr>
            </div>
            <div class="group-names">
                <ul id="group-list">
                    <li><a href="" onclick="createGroup(event)">Create New Group</a></li>
                    <li><a href="">Add Member</a></li>
                    <li><a href="">Remove Member</a></li>
                </ul>
                <hr>
                <h4 style=" text-align: center; color:  #88a9c4ff; font-family: 'Courier New', Courier, monospace;">Your Groups</h4>
                <ul id="your-groups-ul">

                </ul>
            </div>
        </div>
        <div class="users">
            <div class="users-title">Users
                <hr>
            </div>
            <div class="group-names">
                <ul id="group-list">
                    <li><a href="">Harshada</a></li>
                    <li><a href="">Ritesh</a></li>
                    <li><a href="">Rohan</a></li>
                </ul>
            </div>
        </div>
        <div class="chatBox">
            <div class="chatBox-title">Group
                <hr>
            </div>
            <div class="message-box">
                <li id="message-box-li">

                </li>
            </div>
            <div class="text-input">
                <input type="text" placeholder="Enter Message" id="text-box">
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('chatAppToken');
        function parseJwt(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        document.addEventListener('DOMContentLoaded',()=>{
            const parsedToken = parseJwt(token);
            const loggedUsername = document.getElementById('logged-username');
            loggedUsername.innerHTML = `Logged In: ${parsedToken.name}`;
        });

        function createGroup(event){
            event.preventDefault();
            const groupName = prompt('Enter Group Name');

            if(groupName!==null){
                const your_groups_ul = document.getElementById('your-groups-ul');
                const newLi = document.createElement('li');
                newLi.textContent = groupName;
                newLi.style.cursor='pointer';
                your_groups_ul.appendChild(newLi); 
                newLi.addEventListener('click',()=>{
                    console.log(`${groupName}`);
                });
            }
        }

        const chatButton = document.getElementById('send-button').addEventListener('click',()=>{
            const text_input = document.getElementById('text-box').value;
            const message_box_li = document.getElementById('message-box-li');
            const newLi = document.createElement('li');
            const parsedToken = parseJwt(token);
            newLi.innerHTML = `${parsedToken.name}:- ${text_input}`;
            message_box_li.appendChild(newLi);
            text_input.innerHTML = '';
        });
        /*
        create group
once group is created, small button to add member, small button to remove member
no seperate button needed, it will be hard to do otherwise.

add people on their email id or phonenumber 

change the id of that user to this group(something like that, think about it)*/
    </script>
</body>

</html>